---
title: "Compositions"
sidebarTitle: "Compositions"
description: "Orchestrate multi-agent workflows with compositions, transitions, and shared context."
---

Compositions let you combine multiple AI agents into a single coordinated workflow. A composition defines a router agent, a set of specialist agents, transition rules between them, and whether conversation context is shared across handoffs.

## When to Use Compositions

Compositions are ideal when a single agent cannot handle the full scope of a conversation:

- **Receptionist + Specialists**: A front-desk agent routes callers to scheduling, billing, or technical support agents.
- **Qualification + Sales**: A qualification agent gathers lead information, then hands off to a sales agent for the pitch.
- **Triage + Routing**: A medical triage agent assesses urgency and routes to the appropriate specialist.
- **Multi-step Workflows**: Greeting, data collection, processing, and confirmation each handled by a purpose-built agent.

## Creating a Composition

<CodeGroup>
```bash cURL
curl -X POST https://api.relay-agent.com/v1/agents/compose \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Medical Office Workflow",
    "routerAgentId": "agent_receptionist_001",
    "agents": [
      { "id": "agent_receptionist_001", "role": "receptionist" },
      { "id": "agent_scheduler_001", "role": "scheduler" },
      { "id": "agent_nurse_001", "role": "nurse_triage" },
      { "id": "agent_billing_001", "role": "billing" }
    ],
    "transitions": [
      {
        "from": "agent_receptionist_001",
        "to": "agent_scheduler_001",
        "condition": "intent == \"schedule_appointment\""
      },
      {
        "from": "agent_receptionist_001",
        "to": "agent_nurse_001",
        "condition": "intent == \"medical_question\""
      },
      {
        "from": "agent_receptionist_001",
        "to": "agent_billing_001",
        "condition": "intent == \"billing\""
      },
      {
        "from": "agent_nurse_001",
        "to": "agent_scheduler_001",
        "condition": "needs_appointment exists"
      }
    ],
    "sharedContext": true,
    "seamlessHandoff": true
  }'
```

```typescript SDK
const composition = await client.agents.compose({
  name: 'Medical Office Workflow',
  routerAgentId: 'agent_receptionist_001',
  agents: [
    { id: 'agent_receptionist_001', role: 'receptionist' },
    { id: 'agent_scheduler_001', role: 'scheduler' },
    { id: 'agent_nurse_001', role: 'nurse_triage' },
    { id: 'agent_billing_001', role: 'billing' },
  ],
  transitions: [
    {
      from: 'agent_receptionist_001',
      to: 'agent_scheduler_001',
      condition: 'intent == "schedule_appointment"',
    },
    {
      from: 'agent_receptionist_001',
      to: 'agent_nurse_001',
      condition: 'intent == "medical_question"',
    },
    {
      from: 'agent_receptionist_001',
      to: 'agent_billing_001',
      condition: 'intent == "billing"',
    },
    {
      from: 'agent_nurse_001',
      to: 'agent_scheduler_001',
      condition: 'needs_appointment exists',
    },
  ],
  sharedContext: true,
  seamlessHandoff: true,
});
```
</CodeGroup>

## Configuration Reference

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `name` | `string` | Yes | - | Display name for the composition. 1-200 characters. |
| `routerAgentId` | `string` | Yes | - | ID of the agent that starts the call and handles initial routing. |
| `agents` | `array` | Yes | - | List of participating agents with roles. |
| `agents[].id` | `string` | Yes | - | Agent ID. Must reference an existing agent. |
| `agents[].role` | `string` | Yes | - | Human-readable role description. |
| `transitions` | `array` | Yes | - | Rules that govern when to switch agents. |
| `transitions[].from` | `string` | Yes | - | Agent ID of the source agent. |
| `transitions[].to` | `string` | Yes | - | Agent ID of the destination agent. |
| `transitions[].condition` | `string` | Yes | - | Condition expression that triggers the transition. |
| `sharedContext` | `boolean` | No | `true` | Whether agents share the conversation transcript. |
| `seamlessHandoff` | `boolean` | No | `true` | Whether transitions are seamless (no audible gap). |
| `metadata` | `object` | No | - | Arbitrary metadata. |

## Transition Conditions

Transition conditions are evaluated against the current conversation context. The following expression patterns are supported:

| Pattern | Example | Description |
|---------|---------|-------------|
| Equality | `intent == "schedule"` | Variable equals a value |
| Greater than | `score > 7` | Numeric comparison |
| Less than | `score < 3` | Numeric comparison |
| Exists | `appointment_data exists` | Variable is present and not null |
| Always | `always` | Unconditional transition (always triggers) |

Context variables are populated by tool call results, LLM outputs, and explicit variables set during the conversation. For example, if a tool call returns `{ "intent": "schedule" }`, the condition `intent == "schedule"` would evaluate to true.

```json
{
  "transitions": [
    {
      "from": "agent_qualifier",
      "to": "agent_sales",
      "condition": "qualification_score > 7"
    },
    {
      "from": "agent_qualifier",
      "to": "agent_followup",
      "condition": "qualification_score < 4"
    },
    {
      "from": "agent_sales",
      "to": "agent_booking",
      "condition": "ready_to_book exists"
    }
  ]
}
```

<Note>
  Transitions are evaluated in order. The first matching condition wins. If no conditions match, the current agent continues handling the conversation.
</Note>

## Shared Context

When `sharedContext` is `true`, the full conversation transcript is carried over when transitioning between agents. This means the destination agent knows everything that was discussed with previous agents.

When `sharedContext` is `false`, each agent starts with a clean slate. Only its own system prompt and the fresh audio from the caller are used.

| Setting | Use Case |
|---------|----------|
| `true` | Most workflows. Callers do not have to repeat themselves. |
| `false` | Privacy-sensitive transitions where the new agent should not see prior discussion. |

## Seamless Handoff

When `seamlessHandoff` is `true`, the transition between agents happens without any audible gap or interruption. The caller perceives a continuous conversation.

When `seamlessHandoff` is `false`, there may be a brief pause during the agent switch. This can be useful if you want the caller to notice the change (e.g., a different voice or explicit introduction).

## How Calls Work with Compositions

When initiating a call with a composition, reference the composed agent ID:

```bash
curl -X POST https://api.relay-agent.com/v1/calls/phone \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "composedAgentId": "comp_abc123",
    "to": "+15551234567",
    "from": "+15559876543"
  }'
```

The call follows this lifecycle:

1. **Start**: The router agent handles the call initially, speaking its `firstMessage`.
2. **Evaluate**: After each turn, transition conditions are evaluated against the conversation context.
3. **Transition**: If a condition matches, the call transitions to the target agent. With shared context, the transcript carries over.
4. **Continue**: The new agent takes over. Its system prompt and voice are now active.
5. **Repeat**: Transitions can chain. The scheduler agent can transition to a confirmation agent, and so on.
6. **End**: The call ends when the active agent ends it, the caller hangs up, or the max duration is reached.

## Complete Example: Law Firm Intake

```json
{
  "name": "Law Firm Client Intake",
  "routerAgentId": "agent_intake_001",
  "agents": [
    { "id": "agent_intake_001", "role": "intake_specialist" },
    { "id": "agent_pi_001", "role": "personal_injury_specialist" },
    { "id": "agent_family_001", "role": "family_law_specialist" },
    { "id": "agent_business_001", "role": "business_law_specialist" }
  ],
  "transitions": [
    {
      "from": "agent_intake_001",
      "to": "agent_pi_001",
      "condition": "practice_area == \"personal_injury\""
    },
    {
      "from": "agent_intake_001",
      "to": "agent_family_001",
      "condition": "practice_area == \"family_law\""
    },
    {
      "from": "agent_intake_001",
      "to": "agent_business_001",
      "condition": "practice_area == \"business_law\""
    }
  ],
  "sharedContext": true,
  "seamlessHandoff": true
}
```

The intake specialist asks about the nature of the legal matter, identifies the practice area, and the composition automatically routes to the right specialist agent who can ask detailed, domain-specific questions.

<Tip>
  Compositions work alongside [agent_transfer tools](/build/agent-transfers). You can use transitions for automatic routing based on conditions, and agent_transfer tools for manual routing decided by the LLM. Both mechanisms can coexist in the same composition.
</Tip>
