---
title: "Post-Call Analysis"
sidebarTitle: "Post-Call Analysis"
description: "Extract structured data from calls automatically using LLM-powered post-call analysis."
---

Post-call analysis runs automatically after every call ends. It uses the LLM to extract structured data from the conversation transcript -- sentiment, outcomes, action items, and any custom fields you define.

## How It Works

1. The call ends (caller hangs up, agent ends the call, or max duration reached).
2. Relay Agent sends the full transcript to the LLM with analysis instructions.
3. The LLM extracts values for each configured field.
4. Results are stored in the `customAnalysis` field on the call record.
5. If configured, a webhook is sent with the analysis results.

## Configuration

Define analysis fields in the `postCallAnalysis` array on your agent:

```json
{
  "postCallAnalysis": [
    {
      "name": "call_outcome",
      "type": "enum",
      "description": "The primary outcome of the call.",
      "choices": ["resolved", "escalated", "abandoned", "callback_scheduled", "voicemail"]
    },
    {
      "name": "customer_sentiment",
      "type": "enum",
      "description": "The overall sentiment of the caller throughout the conversation.",
      "choices": ["positive", "neutral", "negative", "frustrated"]
    },
    {
      "name": "issue_summary",
      "type": "string",
      "description": "A one-sentence summary of the caller's issue or request."
    },
    {
      "name": "caller_name",
      "type": "string",
      "description": "The caller's name if they provided it."
    },
    {
      "name": "follow_up_needed",
      "type": "boolean",
      "description": "Whether the caller needs a follow-up call or action."
    },
    {
      "name": "satisfaction_score",
      "type": "number",
      "description": "Estimated caller satisfaction from 1 (very dissatisfied) to 5 (very satisfied).",
      "examples": ["1", "3", "5"]
    }
  ]
}
```

## Field Types

Each analysis field has a `type` that determines what kind of data is extracted.

| Type | Description | Extra Fields |
|------|-------------|-------------|
| `string` | Free-form text extraction | `examples` (optional) |
| `enum` | One value from a fixed set of choices | `choices` (required) |
| `boolean` | True or false | - |
| `number` | Numeric value | `examples` (optional) |

### Field Definition

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `name` | `string` | Yes | Unique field name. Used as the key in the analysis results. |
| `type` | `string` | Yes | Data type: `string`, `enum`, `boolean`, `number`. |
| `description` | `string` | Yes | Tells the LLM what to extract. Be specific. |
| `choices` | `string[]` | For `enum` | The allowed values for enum fields. |
| `examples` | `string[]` | No | Example values to guide the LLM. |

## Analysis Results

After analysis completes, results are stored on the call record:

```bash
curl https://api.relay-agent.com/v1/calls/call_abc123 \
  -H "Authorization: Bearer YOUR_API_KEY"
```

```json
{
  "id": "call_abc123",
  "status": "completed",
  "customAnalysis": {
    "call_outcome": "resolved",
    "customer_sentiment": "positive",
    "issue_summary": "Caller needed help resetting their password after a recent email change.",
    "caller_name": "Sarah Johnson",
    "follow_up_needed": false,
    "satisfaction_score": 4
  }
}
```

## Use Case Examples

### Customer Support Classification

```json
{
  "postCallAnalysis": [
    {
      "name": "category",
      "type": "enum",
      "description": "The primary category of the support request.",
      "choices": ["billing", "technical", "account", "product_info", "complaint", "other"]
    },
    {
      "name": "resolution_status",
      "type": "enum",
      "description": "Whether the issue was resolved during the call.",
      "choices": ["resolved", "partially_resolved", "unresolved", "escalated"]
    },
    {
      "name": "product_mentioned",
      "type": "string",
      "description": "The specific product or plan the caller asked about, if any."
    }
  ]
}
```

### Sales Call Analysis

```json
{
  "postCallAnalysis": [
    {
      "name": "lead_quality",
      "type": "enum",
      "description": "Quality of the sales lead based on the conversation.",
      "choices": ["hot", "warm", "cold", "not_a_lead"]
    },
    {
      "name": "interest_level",
      "type": "number",
      "description": "The prospect's interest level on a scale of 1-10.",
      "examples": ["2", "5", "8"]
    },
    {
      "name": "objections",
      "type": "string",
      "description": "Key objections or concerns raised by the prospect."
    },
    {
      "name": "next_step",
      "type": "enum",
      "description": "The agreed-upon next step.",
      "choices": ["demo_scheduled", "proposal_sent", "follow_up_call", "not_interested", "no_next_step"]
    },
    {
      "name": "decision_maker",
      "type": "boolean",
      "description": "Whether the person on the call is the decision maker."
    }
  ]
}
```

### Appointment Confirmation

```json
{
  "postCallAnalysis": [
    {
      "name": "appointment_status",
      "type": "enum",
      "description": "The outcome regarding the appointment.",
      "choices": ["confirmed", "rescheduled", "cancelled", "no_answer", "left_voicemail"]
    },
    {
      "name": "new_date",
      "type": "string",
      "description": "The new appointment date if rescheduled (YYYY-MM-DD format)."
    },
    {
      "name": "new_time",
      "type": "string",
      "description": "The new appointment time if rescheduled (HH:MM format)."
    },
    {
      "name": "cancellation_reason",
      "type": "string",
      "description": "The reason for cancellation if the appointment was cancelled."
    }
  ]
}
```

## Best Practices

### Write specific descriptions

The `description` field is the instruction the LLM uses to extract the value. Be precise about what you want.

```json
{
  "name": "issue_summary",
  "type": "string",
  "description": "A one-sentence summary of the caller's primary issue. Focus on what they needed, not how the conversation went."
}
```

A vague description like "summary of the call" will produce inconsistent results.

### Use enums when possible

Enum fields produce more consistent, machine-readable results than string fields. If you know the possible values, always prefer an enum.

```json
{
  "name": "department",
  "type": "enum",
  "description": "Which department should handle follow-up for this caller.",
  "choices": ["sales", "support", "billing", "engineering", "management"]
}
```

### Provide examples for ambiguous fields

For string and number fields, the `examples` array helps the LLM understand the expected format:

```json
{
  "name": "estimated_deal_size",
  "type": "string",
  "description": "The estimated deal size mentioned or implied during the conversation.",
  "examples": ["$5,000/month", "$50,000 annual contract", "unknown"]
}
```

### Keep the field count reasonable

Each analysis field adds to the post-call LLM request. More fields means higher cost and slower analysis. Aim for 3-8 fields per agent.

<Tip>
  Post-call analysis results are available via webhook immediately after the call ends. Use this to trigger downstream workflows -- update your CRM, create follow-up tasks, send summary emails, or flag calls that need human review.
</Tip>

## With Agent Transfers

When using [agent transfers](/build/agent-transfers), the `postCallAnalysisSetting` controls which agents' analysis configurations run:

| Setting | Behavior |
|---------|----------|
| `both_agents` | Both the source and destination agents' fields are extracted. Results are merged. |
| `only_destination` | Only the destination (final) agent's fields run. |
| `only_source` | Only the source (initial) agent's fields run. |

<Note>
  When both agents' analyses run, field names must be unique across agents. If both define a field with the same name, the destination agent's result takes precedence.
</Note>
